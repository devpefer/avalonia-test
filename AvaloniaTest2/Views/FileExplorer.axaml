<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:AvaloniaTest2.Models"
             xmlns:viewModels="clr-namespace:AvaloniaTest2.ViewModels"
             xmlns:converters="clr-namespace:AvaloniaTest2.Converters"
             x:Class="AvaloniaTest2.Views.FileExplorer"
             x:DataType="viewModels:FileExplorerViewModel">
    
    <UserControl.Resources>
        <converters:BoolToStatusConverter x:Key="BoolToStatusConverter"/>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,Auto,Auto,Auto,*" Margin="5">
        <ComboBox Grid.Row="3"
                  ItemsSource="{Binding SortModes}"
                  SelectedItem="{Binding SelectedSort, Mode=TwoWay}"
                  Width="150" Margin="0,0,0,5"/>
        
        <ProgressBar Grid.Row="0" IsIndeterminate="True" Height="20"
                     IsVisible="{Binding IsCalculatingSizes}" />
        <TextBlock Grid.Row="1" Text="Calculando tamaÃ±os..." 
                   Foreground="Gray"
                   IsVisible="{Binding IsCalculatingSizes}" />
        <TextBlock Grid.Row="2" Text="{Binding CurrentItemBeingProcessed}" 
                   Foreground="Gray"
                   Margin="5,0,0,0" />
        
        
        <ScrollViewer Grid.Row="4" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <TreeView x:Name="Tree" ItemsSource="{Binding RootItems}">
                <TreeView.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Abrir"
                                  Command="{Binding OpenFileCommand}"
                                  CommandParameter="{Binding SelectedItem, ElementName=Tree}" />
                        <MenuItem Header="Abrir carpeta contenedora"
                                  Command="{Binding OpenFolderCommand}"
                                  CommandParameter="{Binding SelectedItem, ElementName=Tree}" />
                        <MenuItem Header="Copiar ruta"
                                  Command="{Binding CopyPathCommand}"
                                  CommandParameter="{Binding SelectedItem, ElementName=Tree}" />
                        <MenuItem Header="Mover a la papelera"
                                  Command="{Binding MoveToTrashCommand}"
                                  CommandParameter="{Binding SelectedItem, ElementName=Tree}" />
                    </ContextMenu>
                </TreeView.ContextMenu>
                <TreeView.DataTemplates>
                    <TreeDataTemplate DataType="models:FileSystemItem"
                                      ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Name}" />
                            <TextBlock Text=" " />
                            <TextBlock Text="{Binding DisplaySize}" Foreground="Gray"/>
                        </StackPanel>
                    </TreeDataTemplate>
                </TreeView.DataTemplates>
            </TreeView>
        </ScrollViewer>
    </Grid>
</UserControl>
